
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Invaders â€“ Power Edition v1.3</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;-webkit-user-select:none;user-select:none}
canvas{display:block;margin:0 auto;background:#000}
#msg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;font-family:sans-serif;color:#fff;background:rgba(0,0,0,.85)}
button{padding:10px 24px;font-size:18px;border:none;border-radius:6px;background:#3498db;color:#fff}
</style>
</head>
<body>
<canvas id="g"></canvas>
<div id="msg"><h1 id="st"></h1><button id="rs">PLAY AGAIN</button></div>
<script>
(()=>{const cvs=document.getElementById('g'),ctx=cvs.getContext('2d');
const dpr=window.devicePixelRatio||1;let W=innerWidth,H=innerHeight;
cvs.width=W*dpr;cvs.height=H*dpr;cvs.style.width=W+'px';cvs.style.height=H+'px';ctx.scale(dpr,dpr);

// ------------------ Game state ------------------
let level=1,score=0,shootCooldown=0,powerTimer=0;
let rapidActive=false,spreadActive=false;
const player={w:40,h:20,x:(W-40)/2,y:H-70,spd:8,baseColor:'#0f0',color:'#0f0'};
const bullets=[],enemyBullets=[],explosions=[],enemies=[],ufos=[],powerUps=[];
const rows=4,cols=8;

// ------------------ Utility ------------------
function rectPointHit(r,x,y){return x>=r.x&&x<=r.x+r.w&&y>=r.y&&y<=r.y+r.h;}
function rectHit(a,b){return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y;}
function explode(x,y){explosions.push({x,y,r:2,a:1});}

// ------------------ Setup ------------------
function spawnWave(){
    enemies.length=0;
    const gap=Math.min(60,W/(cols+1));
    const startX=(W-cols*gap)/2;
    const palette=['#0af','#f0a','#0ff','#fa0'];
    for(let r=0;r<rows;r++){
        for(let c=0;c<cols;c++){
            enemies.push({
                x:startX+c*gap,
                y:60+r*45,
                w:30,h:22,
                dir:1,
                color:palette[r%palette.length],
                speed:1+0.25*(level-1)
            });
        }
    }
    if(level%2===0){
        ufos.push({x:-50,y:30,w:40,h:18,spd:3+level,color:'#ff0'});
    }
}
spawnWave();

// starfield
const stars=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H}));

// ------------------ Draw ------------------
function drawStarfield(){
    ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);
    ctx.fillStyle='#fff';
    stars.forEach(s=>{
        ctx.fillRect(s.x,s.y,1,1);
        s.y+=0.3;
        if(s.y>H){s.y=0;s.x=Math.random()*W;}
    });
}
function draw(){
    drawStarfield();
    // ufo
    ufos.forEach(u=>{ctx.fillStyle=u.color;ctx.fillRect(u.x,u.y,u.w,u.h);});
    // power ups
    powerUps.forEach(p=>{
        ctx.fillStyle=p.type==='RAPID'?'#ff0':'#0ff';
        ctx.beginPath();ctx.arc(p.x,p.y,6,0,Math.PI*2);ctx.fill();
    });
    // player
    ctx.fillStyle=player.color;ctx.fillRect(player.x,player.y,player.w,player.h);
    // bullets
    ctx.fillStyle='#ff0';
    bullets.forEach(b=>ctx.fillRect(b.x,b.y,3,10));
    ctx.fillStyle='#f55';
    enemyBullets.forEach(b=>ctx.fillRect(b.x,b.y,3,10));
    // enemies
    enemies.forEach(e=>{ctx.fillStyle=e.color;ctx.fillRect(e.x,e.y,e.w,e.h);});
    // explosions
    explosions.forEach(ex=>{
        ctx.globalAlpha=ex.a;
        ctx.fillStyle='#fa0';
        ctx.beginPath();ctx.arc(ex.x,ex.y,ex.r,0,Math.PI*2);ctx.fill();
        ctx.globalAlpha=1;
    });
    // HUD
    ctx.fillStyle='#fff';
    ctx.fillText('LEVEL '+level+'  SCORE '+score,10,18);
}

// ------------------ Update ------------------
function update(){
    // cooldown timers
    if(shootCooldown>0) shootCooldown--;
    if(powerTimer>0){
        powerTimer--;
        if(powerTimer===0){ // reset powerup
            rapidActive=spreadActive=false;
            player.color=player.baseColor;
        }
    }
    // bullets move
    bullets.forEach((b,i)=>{
        b.y-=10;
        if(b.dx) b.x+=b.dx;
        if(b.y<-10) bullets.splice(i,1);
    });
    // enemy movement
    let shift=false;
    enemies.forEach(e=>{
        e.x+=e.dir*e.speed;
        if(e.x<10||e.x+e.w>W-10) shift=true;
    });
    if(shift) enemies.forEach(e=>{e.dir*=-1;e.y+=25;});
    // enemy-player collision
    enemies.forEach(e=>{if(rectHit(e,player)) endGame(false);});
    // bullets vs enemies & ufos
    bullets.forEach((b,bi)=>{
        for(let ei=enemies.length-1;ei>=0;ei--){
            const e=enemies[ei];
            if(rectPointHit(e,b.x,b.y)){
                explode(e.x+e.w/2,e.y+e.h/2);
                enemies.splice(ei,1);
                bullets.splice(bi,1);
                score+=100;
                if(Math.random()<0.15) spawnPowerUp(e.x+e.w/2,e.y,'RANDOM');
                break;
            }
        }
        for(let ui=ufos.length-1;ui>=0;ui--){
            const u=ufos[ui];
            if(rectPointHit(u,b.x,b.y)){
                explode(u.x+u.w/2,u.y+u.h/2);
                ufos.splice(ui,1);
                bullets.splice(bi,1);
                score+=200;
                break;
            }
        }
    });
    // ufos move
    ufos.forEach((u,ui)=>{
        u.x+=u.spd;
        if(u.x>W+50) ufos.splice(ui,1);
    });
    // powerups move / collect
    powerUps.forEach((p,pi)=>{
        p.y+=2;
        if(p.y>H) powerUps.splice(pi,1);
        else if(rectPointHit(player,p.x,p.y)){
            applyPower(p.type);
            powerUps.splice(pi,1);
        }
    });
    // enemy bullets shoot
    if(Math.random()<0.02 && enemies.length){
        const e=enemies[Math.random()*enemies.length|0];
        enemyBullets.push({x:e.x+e.w/2,y:e.y+e.h});
    }
    // enemy bullets move
    enemyBullets.forEach((b,bi)=>{
        b.y+=6;
        if(b.y>H) enemyBullets.splice(bi,1);
        else if(rectPointHit(player,b.x,b.y)) endGame(false);
    });
    // explosions decay
    explosions.forEach((ex,xi)=>{
        ex.r+=1.4;
        ex.a-=0.03;
        if(ex.a<=0) explosions.splice(xi,1);
    });
    // wave clear
    if(!enemies.length){
        level++;
        spawnWave();
    }
}

// ------------------ PowerUp ------------------
function spawnPowerUp(x,y,type){
    let ptype=type;
    if(ptype==='RANDOM'){
        ptype=Math.random()<0.5?'RAPID':'SPREAD';
    }
    powerUps.push({x,y,type:ptype});
}
function applyPower(type){
    if(type==='RAPID'){
        rapidActive=true;
        player.color='#ff0';
        powerTimer=600;
    }else if(type==='SPREAD'){
        spreadActive=true;
        player.color='#0ff';
        powerTimer=600;
    }
}

// ------------------ Input ------------------
function shoot(){
    if(shootCooldown>0) return;
    if(spreadActive){
        bullets.push({x:player.x+player.w/2-1.5,y:player.y,dx:0});
        bullets.push({x:player.x+player.w/2-1.5,y:player.y,dx:-2});
        bullets.push({x:player.x+player.w/2-1.5,y:player.y,dx:2});
    }else{
        bullets.push({x:player.x+player.w/2-1.5,y:player.y});
    }
    shootCooldown = rapidActive ? 5 : 15;
}
let left=false,right=false;
addEventListener('keydown',e=>{
    if(e.key==='ArrowLeft') left=true;
    if(e.key==='ArrowRight') right=true;
    if(e.key===' ' && running) shoot();
});
addEventListener('keyup',e=>{
    if(e.key==='ArrowLeft') left=false;
    if(e.key==='ArrowRight') right=false;
});
// touch / pointer input
addEventListener('pointerdown',e=>{if(!running) return; pointerMove(e); shoot();});
addEventListener('pointermove',e=>pointerMove(e));
function pointerMove(e){
    if(!running) return;
    const rect=cvs.getBoundingClientRect();
    player.x = e.clientX - rect.left - player.w/2;
}

// movement interval
setInterval(()=>{
    if(!running) return;
    if(left) player.x-=player.spd;
    if(right) player.x+=player.spd;
    if(player.x<0) player.x=0;
    if(player.x+player.w>W) player.x = W-player.w;
},16);

// ------------------ Game Loop ------------------
let running=true;
function gameLoop(){
    if(running){
        update();
        draw();
        requestAnimationFrame(gameLoop);
    }
}
gameLoop();

// ------------------ Game Over & Restart ------------------
function endGame(win){
    st.textContent = win?'YOU WIN!':'GAME OVER';
    msg.style.display='flex';
    running=false;
}
rs.onclick=()=>{
    // reset
    level=1;score=0;
    player.x=(W-player.w)/2;
    bullets.length=enemyBullets.length=explosions.length=0;
    powerUps.length=ufos.length=0;
    rapidActive=spreadActive=false;player.color=player.baseColor;
    spawnWave();
    running=true;
    msg.style.display='none';
    shootCooldown=0;powerTimer=0;
    gameLoop(); // restart loop
};
addEventListener('resize',()=>location.reload());
})();
</script>
</body>
</html>
