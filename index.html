
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Invaders – Advance Edition</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;-webkit-user-select:none;user-select:none}
canvas{display:block;margin:0 auto;background:#000}
#msg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;font-family:sans-serif;color:#fff;background:rgba(0,0,0,.8)}
button{padding:10px 24px;font-size:18px;border:none;border-radius:6px;background:#3498db;color:#fff}
</style>
</head>
<body>
<canvas id="g"></canvas>
<div id="msg"><h1 id="st"></h1><button id="rs">PLAY AGAIN</button></div>
<script>
(()=>{const cvs=document.getElementById('g'),ctx=cvs.getContext('2d');
const dpr=window.devicePixelRatio||1;let W=innerWidth,H=innerHeight;
cvs.width=W*dpr;cvs.height=H*dpr;cvs.style.width=W+'px';cvs.style.height=H+'px';ctx.scale(dpr,dpr);

let level=1,score=0;
const player={w:40,h:20,x:(W-40)/2,y:H-70,spd:8,color:'#0f0',cool:0,maxCool:6};
const bullets=[],ebullets=[],explosions=[],enemies=[],ufos=[];
const rows=5,cols=9;
function newEnemy(x,y,row){
 return{ x, y, w:32, h:24, dir:1, row, color:['#0af','#f0a','#0ff','#fa0','#ff5050'][row%5],
         speed:1+0.25*(level-1), tick:0, alive:true };
}
function initEnemies(){
 enemies.length=0;const gap=Math.min(55,W/(cols+1));const startX=(W-cols*gap)/2;
 for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)
   enemies.push(newEnemy(startX+c*gap, 60+r*45, r));
 if(level%2===0) ufos.push({x:-50,y:35,w:40,h:18,spd:3+level,color:'#ff0',alive:true});
}
initEnemies();
const stars=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H}));
function starfield(){ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);ctx.fillStyle='#fff';
 stars.forEach(s=>{ctx.fillRect(s.x,s.y,1,1); if((s.y+=0.4)>H){s.y=0;s.x=Math.random()*W;}});}
function draw(){
 starfield();
 ufos.forEach(u=>{ctx.fillStyle=u.color;ctx.fillRect(u.x,u.y,u.w,u.h);});
 ctx.fillStyle=player.color;ctx.fillRect(player.x,player.y,player.w,player.h);
 ctx.fillStyle='#ffa';bullets.forEach(b=>ctx.fillRect(b.x,b.y,b.w,b.h));
 ctx.fillStyle='#f55';ebullets.forEach(b=>ctx.fillRect(b.x,b.y,3,10));
 enemies.forEach(e=>{if(e.alive){ctx.fillStyle=e.color;ctx.fillRect(e.x,e.y,e.w,e.h);}});
 explosions.forEach(ex=>{ctx.globalAlpha=ex.a;ctx.fillStyle='#fa0';ctx.beginPath();
   ctx.arc(ex.x,ex.y,ex.r,0,Math.PI*2);ctx.fill();ctx.globalAlpha=1;});
 ctx.fillStyle='#fff';ctx.fillText(`LEVEL ${level}  SCORE ${score}`,10,18);
}
function update(){
 // player bullet cooldown
 if(player.cool>0)player.cool--;
 bullets.forEach((b,i)=>{b.y-=b.vy;if(b.y<-10)bullets.splice(i,1);});
 // enemy movement patterns
 let shift=false;
 enemies.forEach(e=>{
  if(!e.alive)return;
  e.tick++;
  if(e.row%2===0){ // sine sway rows
    e.y+=Math.sin((e.tick+e.row*20)/40)*0.4;
  }
  e.x+=e.dir*e.speed;
  if(e.x<10||e.x+e.w>W-10)shift=true;
 });
 if(shift) enemies.forEach(e=>{e.dir*=-1;e.y+=25;});
 // enemy-player collision
 enemies.forEach(e=>{if(e.alive&&e.y+e.h>=player.y && e.x<player.x+player.w && e.x+e.w>player.x)gameOver(false);});
 // bullet collisions
 bullets.forEach((b,bi)=>{
   enemies.forEach((e,ei)=>{
     if(e.alive&&b.x<b.w+e.x&&b.x+b.w>e.x&&b.y<b.h+e.y&&b.y+b.h>e.y){
       e.alive=false;score+=100;explosions.push({x:e.x+e.w/2,y:e.y+e.h/2,r:2,a:1});
       bullets.splice(bi,1);
     }
   });
   ufos.forEach(u=>{if(u.alive&&b.x<u.x+u.w&&b.x+b.w>u.x&&b.y<b.h+u.y&&b.y+b.h>u.y){
       u.alive=false;score+=500;explosions.push({x:u.x+u.w/2,y:u.y+u.h/2,r:3,a:1});}});
 });
 // prune dead
 enemies.filter(e=>e.alive);
 ufos.forEach((u,ui)=>{u.x+=u.spd;if(u.x>W+60||!u.alive)ufos.splice(ui,1);});
 // enemy fire patterns
 if(Math.random()<0.015&&enemies.some(e=>e.alive)){
   const shooters=enemies.filter(e=>e.alive);
   const e=shooters[Math.random()*shooters.length|0];
   // choose pattern
   const type=Math.random();
   if(type<0.6){ ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:0,dy:6});}
   else if(type<0.8){ ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:-2,dy:5}); ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:2,dy:5});}
   else{ // burst 3
     ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:0,dy:7});
     ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:-3,dy:6});
     ebullets.push({x:e.x+e.w/2,y:e.y+e.h,dx:3,dy:6});
   }
 }
 ebullets.forEach((b,bi)=>{
   b.x+=b.dx;b.y+=b.dy;
   if(b.y>H||b.x<-10||b.x>W+10)ebullets.splice(bi,1);
   if(b.x<player.x+player.w&&b.x+3>player.x&&b.y+10>player.y&&b.y<player.y+player.h)gameOver(false);
 });
 explosions.forEach((ex,xi)=>{ex.r+=1.4;ex.a-=0.03;if(ex.a<=0)explosions.splice(xi,1);});
 // next wave
 if(enemies.every(e=>!e.alive)){level++;initEnemies();}
}
let run=true;
function loop(){if(run){update();draw();requestAnimationFrame(loop);}}loop();
function gameOver(win){st.textContent=win?'YOU WIN!':'GAME OVER';msg.style.display='flex';run=false;}
function shoot(){
 if(player.cool===0){bullets.push({x:player.x+player.w/2-1.5,y:player.y,w:3,h:10,vy:10});player.cool=player.maxCool;}
}
let left=false,right=false;
addEventListener('keydown',e=>{if(e.key==='ArrowLeft')left=true;if(e.key==='ArrowRight')right=true;if(e.key===' '&&run)shoot();});
addEventListener('keyup',e=>{if(e.key==='ArrowLeft')left=false;if(e.key==='ArrowRight')right=false;});
addEventListener('pointerdown',e=>{pointerMove(e);shoot();});
addEventListener('pointermove',e=>pointerMove(e));
function pointerMove(e){if(!run)return;const rect=cvs.getBoundingClientRect();player.x=e.clientX-rect.left-player.w/2;}
setInterval(()=>{if(!run)return;if(left)player.x-=player.spd;if(right)player.x+=player.spd;
 if(player.x<0)player.x=0;if(player.x+player.w>W)player.x=W-player.w;},16);
rs.onclick=()=>{level=1;score=0;player.x=(W-player.w)/2;player.cool=0;bullets.length=ebullets.length=explosions.length=0;ufos.length=0;initEnemies();run=true;msg.style.display='none';};
addEventListener('resize',()=>location.reload());
})();
</script>
</body>
</html>
