
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Invaders â€“ Sprite Edition v3.5</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<style>
html,body{margin:0;height:100%;background:#000;overflow:hidden;-webkit-user-select:none;user-select:none}
canvas{display:block;margin:0 auto;background:#000}
#msg{position:fixed;inset:0;display:none;align-items:center;justify-content:center;flex-direction:column;font-family:sans-serif;color:#fff;background:rgba(0,0,0,.85)}
button{padding:10px 24px;font-size:18px;border:none;border-radius:6px;background:#3498db;color:#fff}
</style>
</head>
<body>
<canvas id="g"></canvas>
<div id="msg"><h1 id="st"></h1><p id="summary"></p><button id="rs">PLAY AGAIN</button></div>
<script>
(()=>{const cvs=document.getElementById('g'),ctx=cvs.getContext('2d');
const dpr=window.devicePixelRatio||1;let W=innerWidth,H=innerHeight;
cvs.width=W*dpr;cvs.height=H*dpr;cvs.style.width=W+'px';cvs.style.height=H+'px';ctx.scale(dpr,dpr);

// Load sprite sheet (upload sprites.png in same folder)
const sheet=new Image();sheet.src='sprites.png';let ready=false;sheet.onload=()=>ready=true;
const TILE=256; // source tile
const SPR={player:[0,0],enemy0:[1,0],enemy1:[0,1],enemy2:[1,1],enemy3:[0,2],bullet:[2,2],explosion:[2,1]};

// ------- Game State (from v3.5) -------
let level=1,score=0,hi=+localStorage.getItem('si_hi')||0;
const player={w:40,h:40,x:(W-40)/2,y:H-70,spd:8,color:'#0f0'};
let power={type:'',lvl:0,timer:0},cool=0,run=true;
const bullets=[],eBullets=[],explosions=[],enemies=[],ufos=[],drops=[];
const rows=4,cols=8,MID=H*0.5,rnd=Math.random;
const stars=Array.from({length:120},()=>({x:rnd()*W,y:rnd()*H}));

function drawTile(name,dx,dy,dw,dh){
 if(!ready)return false;
 const [col,row]=SPR[name],sx=col*TILE,sy=row*TILE;
 ctx.drawImage(sheet,sx,sy,TILE,TILE,dx,dy,dw,dh);
 return true;
}

// ----- helpers, wave, update, draw similar but use sprites for player/enemy/bullet/explosion
function initWave(){
 enemies.length=0;
 const gap=Math.min(60,W/(cols+1)),sx=(W-cols*gap)/2,colsClr=['enemy0','enemy1','enemy2','enemy3'];
 for(let r=0;r<rows;r++)for(let c=0;c<cols;c++)
  enemies.push({x:sx+c*gap,y:60+r*45,w:30,h:30,dir:1,row:r,
                hspd:1+.25*(level-1),vspd:1+.12*level,spr:colsClr[r%4]});
 if(level%3===0)ufos.push({x:-50,y:30,w:40,h:30,spd:3+level*.4});
}
function shootPattern(){
 if(power.type==='SPREAD'){const n=[0,2,3,5][power.lvl];for(let i=0;i<n;i++){bullets.push({x:player.x+player.w/2-2,y:player.y,dx:(i-(n-1)/2)*2});}}
 else bullets.push({x:player.x+player.w/2-2,y:player.y,dx:0});
}
function drawScene(){
 ctx.fillStyle='#000';ctx.fillRect(0,0,W,H);ctx.fillStyle='#fff';
 stars.forEach(s=>{ctx.fillRect(s.x,s.y,1,1);if((s.y+=.3)>H){s.y=0;s.x=rnd()*W;}});
 // ufos
 ufos.forEach(u=>{if(!drawTile('enemy0',u.x,u.y,u.w,u.h)){ctx.fillStyle='#0f0';ctx.fillRect(u.x,u.y,u.w,u.h);}});
 // drops
 drops.forEach(d=>{ctx.fillStyle=d.type==='RAPID'?'#ff0':'#0ff';ctx.beginPath();ctx.arc(d.x,d.y,6,0,Math.PI*2);ctx.fill();});
 // player
 if(!drawTile('player',player.x,player.y,player.w,player.h)){ctx.fillStyle=player.color;ctx.fillRect(player.x,player.y,player.w,player.h);}
 // enemies
 enemies.forEach(e=>{if(!drawTile(e.spr,e.x,e.y,e.w,e.h)){ctx.fillStyle='#0af';ctx.fillRect(e.x,e.y,e.w,e.h);}});
 // bullets
 ctx.fillStyle='#ff0';bullets.forEach(b=>{if(!drawTile('bullet',b.x,b.y,6,12))ctx.fillRect(b.x,b.y,3,10);});
 ctx.fillStyle='#f55';eBullets.forEach(b=>ctx.fillRect(b.x,b.y,3,10));
 // explosions
 explosions.forEach(ex=>{ctx.globalAlpha=ex.a;
   if(!drawTile('explosion',ex.x-15,ex.y-15,30,30)){ctx.fillStyle='#fa0';ctx.beginPath();ctx.arc(ex.x,ex.y,ex.r,0,Math.PI*2);ctx.fill();}
   ctx.globalAlpha=1;});
 // HUD
 ctx.fillStyle='#fff';ctx.fillText(`L${level} S${score} HI${hi}`,10,18);
 if(power.type){const bar=80,rem=power.timer/600;ctx.fillStyle='#555';ctx.fillRect(W-bar-20,10,bar,6);
  ctx.fillStyle=power.type==='RAPID'?'#ff0':'#0ff';ctx.fillRect(W-bar-20,10,bar*rem,6);
  ctx.strokeStyle='#fff';ctx.strokeRect(W-bar-20,10,bar,6);
  ctx.fillText(power.type+' Lv'+power.lvl,W-bar-20,28);}
}
// ... update logic remains same as earlier v3.5 but omitted for brevity
</script>
</body>
</html>
